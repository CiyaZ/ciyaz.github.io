# 控制器

这篇笔记我们详细了解一下ThinkPHP5中，控制器的使用。

## 控制器的创建

我们可以使用框架提供的`think`命令创建一个简单的控制器，下面例子在`index`模块中创建一个`Test`控制器：

```
php think make:controller index/Test --plain
```

* 创建的路径格式为`<模块名>/<控制器名>`
* `--plain`：创建简单控制器，默认创建的是资源控制器（后文介绍）

执行命令后，我们得到application/index/controller/Test.php：
```php
<?php

namespace app\index\controller;

use think\Controller;

class Test extends Controller
{
}
```

注意控制器的`namespace`，它自动生成的值为`app/<模块名>/controller`，如果你是手动创建的控制器类，不要写错，否则会正确影响路由。

## 编写控制器方法

在自动生成的代码的基础上，我们添加一个`test()`方法，它仅仅是返回一个字符串：
```php
<?php

namespace app\index\controller;

use think\Controller;

class Test extends Controller
{
    public function test() {
    	return 'hello, world!';
    }
}
```

编写好代码后，使用浏览器访问`localhost/index/test/test`，即可访问到该方法。默认在未配置任何路由的情况下，我们可以通过`模块名/控制器名/方法名`的形式访问到我们定义的控制其方法，但是如果配置了一个路由，就不能直接进行访问了。

## 读取请求参数

在控制器中，我们可以通过Request对象读取请求参数。

```php
public function test() {
  $id = $this->request->param('id');
  return 'param id is '.$id;
}
```

我们可以使用`$this->request`获得该对象，也可以通过方法参数注入（参考前一篇笔记），效果都是一样的。

`param()`能够自动识别不同的HTTP请求方法，GET或POST都能自动处理。如果你希望仅处理POST，可以使用`post()`接收请求参数，GET请求的参数就不会被解析了。例子代码如下：

```php
public function test()
{
  if ($this->request->isPost()) {
    $id = $this->request->post('id');
    return 'param id is ' . $id;
  } else {
    return response('405 method not allowed', 405);
  }
}
```

实际上，如果你想彻底禁止GET请求，对其返回一个错误码，更好的方式是从路由层面入手解决。

## 返回响应

前面我们直接在控制器方法中，返回了一个字符串，这是最简单的放回方式，更常用的是返回JSON或HTML。返回json非常简单，ThinkPHP提供了相关的工具函数供我们使用：

```php
public function test()
{
  $resp_data = array('username' => 'ciyaz', 'password' => '123456');
  return json($resp_data);
}
```

我们可以设定响应体中的一些内容，比如响应状态码，前面例子返回`405`状态码时用到过，这里就不过多叙述了。

返回HTML一版本称为后端渲染，它需要配合MVC的视图层模板完成，这部分内容将在模板相关章节进行介绍。
