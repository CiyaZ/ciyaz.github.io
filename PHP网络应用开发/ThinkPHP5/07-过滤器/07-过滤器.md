# 过滤器

ThinkPHP中具有「中间件（Middleware）」的概念，用于拦截、过滤HTTP请求，在JavaEE中这个组件通常叫过滤器或拦截器，「中间件」这个名字起的有点让人误解，一开始我还以为是某种应用架构组件，这里我们还是将其统称为过滤器。

## 过滤器定义

我们可以使用`think`命令自动生成过滤器。这里我生成一个过滤器用于检查用户是否登录：
```
php think make:middleware LoginCheck
```

执行完成后，会生成`application/http/middleware/LoginCheck.php`。这里我们为了检验登录，登录时为了保存登录状态我们会设置session，登录过滤器主要就是检查一下session是否已设置。

```php
class LoginCheck
{
    public function handle($request, \Closure $next)
    {
    	$user = $request->session('user');
    	if($user == null || $user == '') {
    		return redirect('/login/login/login');
	    } else {
		    return $next($request);
	    }
    }
}
```

上面逻辑很简单，首先通过`$request`对象获取session，如果用户登录session已设置则放行，否则重定向到登录页面。

## 过滤器注册

过滤器需要在路由中进行注册。这里，我们的内部页面路径是`index/my_view/test`，我们对这个地址进行拦截。

```php
Route::rule('index/my_view/test', 'index/my_view/test')->middleware('LoginCheck');
```

注：注册过滤器必须配合路由使用，但是如果我们不对一个控制器方法注册路由，它也有默认访问路径，即`<模块名>/<控制器名>/<方法名>`，ThinkPHP的过滤器是新出的功能还不太完善，对于这种路径暂时只能通过`Route::rule('', '')`注册一个和默认路径相同的路由解决。
