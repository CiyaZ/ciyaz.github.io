# 表单验证器

ThinkPHP提供了一个验证器组件，用法和Java中的Hibernate实体类验证注解很类似，能够很容易的校验表单数据是否符合要求。

## 生成一个验证器组件

我们可以使用`think`命令直接生成一个验证器组件。

下面例子在`login`模块生成一个叫做`Login`的表单验证器，我们用它对登录表单进行校验：
```
php think make:validate login/Login
```

自动生成的代码中，类有两个属性：

* `$rule`：验证规则
* `$message`：出错时的消息

## 编写验证器组件

```php
namespace app\login\validate;

use think\Validate;

class Login extends Validate
{
    /**
     * 定义验证规则
     * 格式：'字段名'	=>	['规则1','规则2'...]
     *
     * @var array
     */
	protected $rule = [
		'username' => 'require|max:25|regex:^[a-zA-Z0-9]*$',
		'password' => 'require|max:25'
	];

    /**
     * 定义错误信息
     * 格式：'字段名.规则名'	=>	'错误信息'
     *
     * @var array
     */
    protected $message = [
    	'username.require' => '用户名不能为空',
	    'username.max' => '用户名不能超过25个字符',
      'username.regex' => '用户名只能包含字母或数字',
	    'password.require' => '密码不能为空',
	    'password.max' => '密码不能超过25个字符'
    ];
}
```

上面代码的逻辑非常简单，我们要求用户名和密码都不能为空，且都不能超过25个字符。另外，还对用户名进行了正则的约束，只允许该项包含数字或字母。

## 在控制器中调用验证器进行验证

下面例子代码中，我们在登录处理逻辑中，进行了用户登录表单的校验。

```php
$data = array(
  'username' => $username,
  'password' => $password
);
$validate = new \app\login\validate\Login();
if(!$validate->check($data)) {
  $this->assign('err_msg', $validate->getError());
  return $this->fetch('../application/login/view/login/login.html');
}
```

* `$validate->check($data)`：验证通过返回true，否则返回false
* `$validate->getError()`：当验证不通过时，获取验证器中定义的错误提示

注：验证器的`check()`方法在第一次匹配失败时就会返回，因此如果用户提交的表单中多个不符合要求的输入，每次只会返回其第一个错误的信息。
