# 资源控制器

资源控制器对应的就是一个数据实体的增删改查操作，由于REST风格的API很适合这类操作，因此ThinkPHP的资源控制器也是按照REST风格实现的。

我们当然也可以直接使用普通控制器实现REST接口，资源控制器已经帮我们做了很多通用功能的实现了，因此能节省一些代码，但缺点则是局限性比较大。对于REST每个人的理解可能都不尽相同，也许我们要实现的效果中某一个细节资源控制器就是没办法实现，这时候还是推荐使用普通控制器自己实现。

注：如果你不认同REST规范，用自己的写法也是完全没问题的，只要能清晰的表达接口的功能即可。

## 创建资源控制器

下面例子创建一个学生增删改查接口，将其创建在`index`模块：
```
php think make:controller index/Student
```

自动生成的代码如下：
```php
<?php

namespace app\index\controller;

use think\Controller;
use think\Request;

class Student extends Controller
{
    public function index() {}

    public function create() {}

    public function save(Request $request) {}

    public function read($id) {}

    public function edit($id) {}

    public function update(Request $request, $id) {}

    public function delete($id) {}
}
```

## 注册资源路由

资源控制器需要配合资源路由才能使用。资源路由在`route/route.php`中进行配置：

```php
Route::resource('student', 'index/student');
```

资源路由配置完成后，我们就可以用ThinkPHP定义的若干REST方法，对资源进行增删改查了。资源路由和资源控制器方法对应如下：

| 请求类型 | 路由规则         | 方法名 | 说明               |
| -------- | ---------------- | ------ | ------------------ |
| GET      | student          | index  | 获取数据实体列表   |
| GET      | student/create   | create | 显示创建资源表单页 |
| POST     | student          | save   | 新建资源           |
| GET      | student/:id      | read   | 根据ID查询资源     |
| GET      | student/:id/edit | edit   | 显示更新资源表单页 |
| PUT      | student/:id      | update | 更新资源           |
| DELETE   | student/:id      | delete | 删除资源           |

其中，`create()`和`edit()`在完全前后端分离的项目中，是不会用到的。其余几个方法就是标准的REST操作方法了。

## 注册嵌套资源路由

如果我们查询的数据实体是嵌套的，比如我们查询班级ID为2，学生ID为3的一名同学，如何表达班级ID呢？一种方式是使用请求参数，即类似`api/student/3?class_id=2`。另一种更加Restful的写法是`api/class/2/student/3`（注：这里的ID并不一定是数字）。这种写法更加清晰的表达了班级和学生这两个数据模型是包含的关系，此时需要注册嵌套资源路由。

```php
Route::resource('class.student', 'index/student');
```

资源路由方法参数也要进行修改，比如`read()`函数需要加一个参数：

```php
public function read($id, $class_id) {...}
```

参数名是嵌套外层资源路由名，加上`_id`的形式指定的。
