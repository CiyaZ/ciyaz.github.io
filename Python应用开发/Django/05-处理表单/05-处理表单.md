# 处理表单

这篇笔记计入如何在django中处理表单。

## 简单的例子

这里以学生注册作为例子。

models.py
```python
class Student(models.Model):
	username = models.CharField(max_length=20)
	password = models.CharField(max_length=20)

	def __str__(self):
		return "[" + self.username + "," + self.password + "]"
```

views.py
```python
def post_student(request):
	stu_name = request.POST.get("username")
	stu_age = request.POST.get("age")
	if stu_name is None:
		return render(request, "app1/add_user.html")
	else:
		print(stu_name, stu_age)
		return HttpResponseRedirect("/app1/users")
```

View代码很简单，如果是携带数据的POST请求（表单提交），就打印表单提交的数据，如果是GET请求，就返回表单页面。这里，用`request.method`进行判断也是可以的。

urls.py
```python
url(r'^student/$', views.post_student)
```

add_user.html
```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>创建用户</title>
</head>
<body>
	<form action="/app1/student/" method="post">
		{% csrf_token %}
		<input type="text" name="username" />
		<input type="text" name="age" />
		<input type="submit" value="submit"/>
	</form>
</body>
</html>
```

注意：默认django需要一个csrf_token表单参数，这个很常用，所以django自带了这个功能，POST提交表单时，不写csrf_token表单POST请求是会失败的。csrf_token主要是防用户手抖点两次提交，其次可以一定程度上防止跨站请求伪造。

## 表单校验

表单校验直接在views里写校验代码即可，有错误就通过context进行输出。

## 比较复杂的表单处理

当然Django有个`django.forms`模块，能用代码辅助表单模板编写，能自动把表单字段映射到实体类，跟struts2和springmvc整一堆表单标签是一个道理，但是太麻烦了，比较复杂的系统建议上Java，而且通常是ajax传json，这里就不多说了。
