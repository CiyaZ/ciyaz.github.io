# venv 虚拟环境

Python有着众多的第三方库，这些库版本、库的依赖库版本、依赖Python的版本之间，可能会有着非常复杂的关系，给我们开发时的依赖管理带来了难度。而且我们不同的工程可能要依赖不同版本的依赖库，难道我们切换工程还要同时装卸一组不同的库吗？venv可以创建一个Python的虚拟环境解决这个问题，实际上，像NodeJS等生态中也有类似的方案。

注：我这里使用的是Python3.6，新版本的Python3中，`venv`是Python标准库中原生支持的，老版本中有各种不同的类似功能的库，我们不需要考虑了。

## 创建虚拟环境

在当前环境创建一个虚拟环境：
```
python -m venv .
```

执行这条命令后，稍等一会，就能自动生成虚拟环境所需的文件了。然后运行`Scripts/activate.bat`（Windows），我们当前的控制台就可以切换到虚拟环境了。

## 虚拟环境中的包管理

旧版本的`venv`创建的虚拟环境缺失`pip`，但新版中已经修复了，我们切换到虚拟环境后，可以直接使用`pip`安装我们需要的依赖包。

## 导出虚拟环境的依赖包

在其他开发语言环境中，使用`Maven`或是`npm`之类的包管理工具时，我们的工程都必须有一个依赖描述文件，但Python中对依赖库的管理比较松散，如果不使用`venv`，依赖全部是全局安装，依赖管理也是比较难做到的，因此这个依赖描述文件也不是强制性的。但使用`venv`时，还是推荐更加规范的做法。

```
pip freeze > requirements.txt
```

该命令首先调用`pip freeze`，将`venv`环境中的全部依赖导出，生成如下内容。

```
click==7.1.2
Flask==1.1.2
itsdangerous==1.1.0
Jinja2==2.11.3
MarkupSafe==1.1.1
Werkzeug==1.0.1
```

然后将生成的内容重定向到`requirements.txt`文件中。根据这个文件，我们在一个新的`venv`环境下也能快速安装该工程的所有依赖了。

```
pip install -r requirements.txt
```

注：我们可以看到，`requirements.txt`这个文件名其实是我们自己起的，Python并没有强制要求叫这个名字，但这是一种约定。
